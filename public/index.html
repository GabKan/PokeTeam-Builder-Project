<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Team Builder</title>
    <link rel="stylesheet" href="styles/main.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Handjet:wght@100..900&family=Press+Start+2P&display=swap" rel="stylesheet">
</head>

<body>
    <div class="builider-section">
        <h1>Pokemon Team Builder</h1>
        <div>
            <button id="save-button" style="display: none;" onclick="saveTeam()">Save Team</button>
            <button id="share-button" onclick="copyToClipboard()">Share</button>

            <button id="signup-button" onclick="window.location.href='signup.html'">Sign Up</button>
            <button id="view-teams" onclick="window.location.href='profile.html'">View Saved Teams</button>
            <button id="logout-button" style="display: none;">Log Out</button>
        </div>
    </div>
    
    <div id="loading-screen">
            
        <div class="spinner"></div>
            <p style="margin-top: 10px; font-size: 1.2rem;">Loading...</p>
    </div>

    <main>
        <section id="pk1" class="card">
            <div class="poke_info">
                <label>Pokemon Name</label>
                <div class="search-container">
                    <input type="text" onclick="display_list(1)" onkeyup="filterPokemon(1)" placeholder="Name" id="pokeSearch1">
                    <ul id="pokeList1" class="list">
                    </ul>
                </div>

                <label>Nickname</label>
                <input type="text" class="nickname" placeholder="Nickname(Optional)">
        
                <div class="image-move-row">
                    <div id="pk_img1" class="poke_image"></div>
                    <div class="move-wrapper">
                        <div class="moves-box">
                            <select class="move_dropdown1">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown1">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown1">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown1">
                                <option value="">Select Move</option>
                            </select>
                        </div>
                    </div>
                </div>
                <label>Pokemon Type: </label>
                <div id="poke_type1" class="poke_type_container">
                </div>
            </div>

        </section>

        <section id="pk2" class="card">
            <div class="poke_info">
                <label>Pokemon Name</label>
                <div class="search-container">
                    <input type="text" onclick="display_list(2)" onkeyup="filterPokemon(2)" placeholder="Name" id="pokeSearch2">
                    <ul id="pokeList2" class="list">
                    </ul>
                </div>

            <label>Nickname</label>
            <input type="text" class="nickname" placeholder="Nickname(Optional)">

                <div class="image-move-row">
                    <div id="pk_img2" class="poke_image"></div>
                    <div class="move-wrapper">
                        <div class="moves-box">
                            <select class="move_dropdown2">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown2">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown2">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown2">
                                <option value="">Select Move</option>
                            </select>
                        </div>
                    </div>
                </div>
                <label>Pokemon Type: </label>
                <div id="poke_type2" class="poke_type_container">
                </div>
            </div>

        </section>

        <section id="pk3" class="card">
            <div class="poke_info">
                <label>Pokemon Name</label>
                <div class="search-container">
                    <input type="text" onclick="display_list(3)" onkeyup="filterPokemon(3)" placeholder="Name" id="pokeSearch3">
                    <ul id="pokeList3" class="list">
                    </ul>
                </div>

            <label>Nickname</label>
            <input type="text" class="nickname" placeholder="Nickname(Optional)">

                <div class="image-move-row">
                    <div id="pk_img3" class="poke_image"></div>
                    <div class="move-wrapper">
                        <div class="moves-box">
                            <select class="move_dropdown3">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown3">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown3">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown3">
                                <option value="">Select Move</option>
                            </select>
                        </div>
                    </div>
                </div>
                <label>Pokemon Type:</label>
                <div id="poke_type3" class="poke_type_container">
                </div>
            </div>
        </section>

        <section id="pk4" class="card">
            <div class="poke_info">
                <label>Pokemon Name</label>
                <div class="search-container">
                    <input type="text" onclick="display_list(4)" onkeyup="filterPokemon(4)" placeholder="Name" id="pokeSearch4">
                    <ul id="pokeList4" class="list">
                    </ul>
                </div>

            <label>Nickname</label>
            <input type="text" class="nickname" placeholder="Nickname(Optional)">
            
                <div class="image-move-row">
                    <div id="pk_img4" class="poke_image"></div>
                    <div class="move-wrapper">
                        <div class="moves-box">
                            <select class="move_dropdown4">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown4">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown4">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown4">
                                <option value="">Select Move</option>
                            </select>
                        </div>
                    </div>
                </div>
                <label>Pokemon Type:</label>
                <div id="poke_type4" class="poke_type_container">
                </div>
            </div>
        </section>

        <section id="pk5" class="card">
            <div class="poke_info">
                <label>Pokemon Name</label>
                <div class="search-container">
                    <input type="text" onclick="display_list(5)" onkeyup="filterPokemon(5)" placeholder="Name" id="pokeSearch5">
                    <ul id="pokeList5" class="list">
                    </ul>
                </div>

            <label>Nickname</label>
            <input type="text" class="nickname" placeholder="Nickname(Optional)">

                <div class="image-move-row">
                    <div id="pk_img5" class="poke_image"></div>
                    <div class="move-wrapper">
                        <div class="moves-box">
                            <select class="move_dropdown5">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown5">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown5">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown5">
                                <option value="">Select Move</option>
                            </select>
                        </div>
                    </div>
                </div>
                <label>Pokemon Type:</label>
                <div id="poke_type5" class="poke_type_container">
                </div>
            </div>
        </section>

        <section id="pk6" class="card">
            <div class="poke_info">
                <label>Pokemon Name</label>
                <div class="search-container">
                    <input type="text" onclick="display_list(6)" onkeyup="filterPokemon(6)" placeholder="Name" id="pokeSearch6">
                    <ul id="pokeList6" class="list">
                    </ul>
                </div>

            <label>Nickname</label>
            <input type="text" class="nickname" placeholder="Nickname(Optional)">
            

                <div class="image-move-row">
                    <div id="pk_img6" class="poke_image"></div>
                    <div class="move-wrapper">
                        <div class="moves-box">
                            <select class="move_dropdown6">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown6">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown6">
                                <option value="">Select Move</option>
                            </select>
                            <select class="move_dropdown6">
                                <option value="">Select Move</option>
                            </select>
                        </div>
                    </div>
                </div>
                <label>Pokemon Type:</label>
                <div id="poke_type6" class="poke_type_container">
                </div>
            </div>
        </section>

        <div class="enter-button-container">
            <button onclick="calc_team()" class="enter-button">Calculate</button>
        </div>

    </main>
    

    <div class="type-container">
        <div class="type-category">
            <h2>Weaknesses</h2>
            <div id="weaknesses" class="type_line"></div>
        </div>

        <div class="type-category">
            <h3>Super-Effective</h3>
            <div id="super-effective" class="type_line"></div>
        </div>

        <div class="type-category">
            <h4>Resistances</h4>
            <div id="resistances" class="type_line"></div>
        </div>
        <div class="type-category">
            <h5>Resisted By</h5>
            <div id="resisted" class="type_line"></div>
        </div>
    </div>

</body>
<script src="scripts/main.js"></script>
<script src="scripts/profile.js" type="module"></script>

<script type="module">

import { auth, logout } from "./scripts/auth.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-auth.js";
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

import firebaseConfig from "./firebaseConfig.js";

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

document.addEventListener("DOMContentLoaded", () => {
    const saveButton = document.getElementById("save-button");
    const shareButton = document.getElementById("share-button");
    const signupButton = document.getElementById("signup-button");
    const logoutButton = document.getElementById("logout-button");
    const viewTeamsButton = document.getElementById("view-teams");

    logoutButton.onclick = async () => {
        try {
            await logout();
            alert("You have been logged out.");
        } catch (error) {
            console.error("Error logging out:", error.message);
        }
    };

    onAuthStateChanged(auth, (user) => {
        if (user) {
            if (saveButton) saveButton.style.display = "inline-block";
            if (shareButton) shareButton.style.display = "inline-block";
            if (signupButton) signupButton.style.display = "none";
            if (logoutButton) logoutButton.style.display = "inline-block";
            if (viewTeamsButton) viewTeamsButton.style.display = "inline-block";
        } else {
            if (saveButton) saveButton.style.display = "none";
            if (shareButton) shareButton.style.display = "none";
            if (signupButton) signupButton.style.display = "inline-block";
            if (logoutButton) logoutButton.style.display = "none";
            if (viewTeamsButton) viewTeamsButton.style.display = "none";
        }
    });
});

document.addEventListener('DOMContentLoaded', async () => {
    const teamId = sessionStorage.getItem('teamId');

    if (!teamId) {
        console.error("No teamID found in URL.");
        return;
    }

    onAuthStateChanged(auth, async (user) => {
        if (!user) {
            alert("You must be logged in to view this team.");
            return;
        }

        try {
            const teamDocRef = doc(db, "users", user.uid, "teams", teamId);
            const teamDoc = await getDoc(teamDocRef);

            if (!teamDoc.exists()) {
                console.error("No such team found in Firestore.");
                return;
            }

            const team = teamDoc.data().team;

            for (let i = 0; i < Math.min(team.length, 6); i++) {
                const pokemon = team[i];
                const slot = i + 1;

                await display_pokemon_info(pokemon.id, slot);
            }
        } catch (error) {
            console.error("Error loading team from Firestore:", error);
        }
    });
});

</script>

</html>